<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –≤—ã–≥–æ—Ä–∞–Ω–∏—è</title>
<!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–∞—Ä—Ç–∏–Ω–∫–∏ –∏–∑ HTML -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
/* ===== VARIABLES (Corporate Colors) ===== */
:root {
  --c-dark: #003B48;   /* Dark Teal */
  --c-gray: #495761;   /* Slate Gray */
  --c-red:  #C31532;   /* Corporate Red */
  
  --c-bg: #f8fafc;
  --c-border: #e2e8f0;
  
  /* Semantic colors for results */
  --s-good: #10b981; /* Green */
  --s-warn: #f59e0b; /* Yellow */
  --s-bad:  var(--c-red); /* Red */
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
  color: var(--c-gray);
  background: transparent; /* –î–ª—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ–≥–æ –≤—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏—è */
  line-height: 1.5;
}

/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–∏–¥–∂–µ—Ç–∞ */
.widget-app {
  max-width: 700px;
  margin: 0 auto;
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(73, 87, 97, 0.1);
  overflow: hidden;
  border: 1px solid var(--c-border);
}

/* ===== HEADER ===== */
.header {
  background: var(--c-dark);
  color: #fff;
  padding: 24px;
  text-align: center;
}
.header h2 { font-size: 1.3rem; margin-bottom: 6px; font-weight: 700; }
.header p { font-size: 0.9rem; opacity: 0.85; }

/* ===== SCREENS ===== */
.screen { display: none; padding: 24px; }
.screen.active { display: block; animation: fadeIn 0.4s ease; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

/* ===== INTRO ===== */
.intro-box {
  background: var(--c-bg);
  padding: 20px;
  border-left: 4px solid var(--c-dark);
  border-radius: 8px;
  margin-bottom: 24px;
}
.btn-primary {
  display: block; width: 100%; max-width: 250px; margin: 0 auto;
  background: var(--c-dark); color: #fff;
  border: none; padding: 14px; border-radius: 8px;
  font-size: 1.05rem; font-weight: 600; cursor: pointer;
  transition: opacity 0.2s;
}
.btn-primary:hover { opacity: 0.9; }
.btn-primary:disabled { background: var(--c-border); color: var(--c-gray); cursor: not-allowed; }

/* ===== WIZARD (QUIZ) ===== */
.progress-bar {
  background: var(--c-border); height: 6px; border-radius: 4px;
  margin-bottom: 20px; overflow: hidden;
}
.progress-fill {
  background: var(--c-dark); height: 100%; width: 0%;
  transition: width 0.3s ease;
}
.q-meta { text-align: center; font-size: 0.85rem; color: var(--c-gray); margin-bottom: 16px; font-weight: 600; }
.q-text { font-size: 1.15rem; font-weight: 600; text-align: center; color: var(--c-dark); margin-bottom: 24px; min-height: 55px;}

/* Scale options */
.legend-top {
  display: flex; justify-content: space-between;
  font-size: 0.75rem; color: var(--c-gray); margin-bottom: 8px; font-weight: 500;
}
.options-row {
  display: flex; gap: 8px; margin-bottom: 30px;
}
.opt-btn {
  flex: 1; height: 50px; border: 2px solid var(--c-border);
  background: #fff; color: var(--c-gray);
  border-radius: 8px; font-size: 1.1rem; font-weight: 700;
  cursor: pointer; transition: all 0.2s;
  display: flex; align-items: center; justify-content: center;
}
.opt-btn:hover { border-color: var(--c-gray); background: var(--c-bg); }
.opt-btn.selected { background: var(--c-dark); border-color: var(--c-dark); color: #fff; }

.nav-buttons { display: flex; gap: 12px; }
.btn-sec {
  flex: 1; background: var(--c-bg); color: var(--c-gray); border: 1px solid var(--c-border);
  padding: 12px; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s;
}
.btn-sec:hover { background: var(--c-border); }
.btn-next {
  flex: 2; background: var(--c-dark); color: #fff; border: none;
  padding: 12px; border-radius: 8px; font-weight: 600; cursor: pointer; transition: opacity 0.2s;
}
.btn-next:disabled { background: var(--c-border); color: var(--c-gray); cursor: not-allowed; }

/* ===== RESULTS ===== */
/* Wrapper for image export */
#export-wrap { background: #fff; padding: 20px; border-radius: 8px; }

.r-card {
  border: 1px solid var(--c-border); border-radius: 10px; padding: 16px 20px;
  margin-bottom: 12px;
}
.r-card h4 { color: var(--c-dark); margin-bottom: 4px; font-size: 1.05rem;}
.score-line { display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; }
.score-num { font-size: 1.5rem; font-weight: 800; }

.bar-bg { background: var(--c-bg); height: 8px; border-radius: 4px; overflow: hidden; }
.bar-fg { height: 100%; transition: width 1s ease; }
/* Semantic colors */
.bg-good { background: var(--s-good); } .col-good { color: var(--s-good); }
.bg-warn { background: var(--s-warn); } .col-warn { color: var(--s-warn); }
.bg-bad  { background: var(--s-bad); }  .col-bad  { color: var(--s-bad); }

.r-desc { font-size: 0.85rem; margin-top: 10px; color: var(--c-gray); }

/* Overall */
.overall-box { text-align: center; padding: 20px; background: var(--c-bg); border-radius: 10px; margin: 20px 0; }
.overall-box h3 { margin-bottom: 8px; }

/* Recs */
.recs h4 { color: var(--c-dark); margin: 16px 0 8px; }
.recs ul { padding-left: 20px; font-size: 0.85rem; margin-bottom: 16px; }
.recs li { margin-bottom: 4px; }

/* Actions */
.actions { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 20px; }
.btn-save { flex: 1; background: var(--c-red); color: #fff; border: none; padding: 12px; border-radius: 8px; font-weight: 600; cursor: pointer; }
.btn-save:hover { opacity: 0.9; }

@media(max-width: 500px) {
  .opt-btn { height: 40px; font-size: 1rem; }
  .screen { padding: 16px; }
  .actions { flex-direction: column; }
}
</style>
</head>
<body>

<div class="widget-app">
  <div class="header">
    <h2>–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –≤—ã–≥–æ—Ä–∞–Ω–∏—è</h2>
    <p>–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Å–∞–º–æ–∞–Ω–∞–ª–∏–∑–∞ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è</p>
  </div>

  <!-- SCREEN 1: INTRO -->
  <div id="screen-intro" class="screen active">
    <div class="intro-box">
      <p>–ù–∏–∂–µ –ø—Ä–∏–≤–µ–¥–µ–Ω—ã 15 —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π –æ —Ä–∞–±–æ—á–∏—Ö –±—É–¥–Ω—è—Ö.</p>
      <p>–û—Ü–µ–Ω–∏—Ç–µ, –∫–∞–∫ —á–∞—Å—Ç–æ –≤—ã –∏—Å–ø—ã—Ç—ã–≤–∞–µ—Ç–µ —ç—Ç–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è. –í–¥—É–º—á–∏–≤–æ –æ—Ç–≤–µ—á–∞–π—Ç–µ –Ω–∞ –∫–∞–∂–¥—ã–π –≤–æ–ø—Ä–æ—Å.</p>
    </div>
    <button class="btn-primary" onclick="startQuiz()">–ù–∞—á–∞—Ç—å –∞–Ω–∞–ª–∏–∑</button>
  </div>

  <!-- SCREEN 2: WIZARD -->
  <div id="screen-quiz" class="screen">
    <div class="progress-bar"><div class="progress-fill" id="prog"></div></div>
    <div class="q-meta" id="q-counter">–í–æ–ø—Ä–æ—Å 1 –∏–∑ 15</div>
    
    <div class="q-text" id="q-text">–¢–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞</div>
    
    <div class="legend-top">
      <span>0 - –ù–∏–∫–æ–≥–¥–∞</span>
      <span>6 - –ö–∞–∂–¥—ã–π –¥–µ–Ω—å</span>
    </div>
    <div class="options-row" id="opts-container">
      <!-- Buttons 0-6 generated by JS -->
    </div>

    <div class="nav-buttons">
      <button class="btn-sec" id="btn-prev" onclick="goPrev()">–ù–∞–∑–∞–¥</button>
      <button class="btn-next" id="btn-next" onclick="goNext()" disabled>–î–∞–ª–µ–µ</button>
    </div>
  </div>

  <!-- SCREEN 3: RESULTS -->
  <div id="screen-results" class="screen">
    <!-- –ë–ª–æ–∫ –¥–ª—è —Å–∫—Ä–∏–Ω—à–æ—Ç–∞ -->
    <div id="export-wrap">
      <div style="text-align: center; margin-bottom: 16px;">
        <h3 style="color: var(--c-dark);">–í–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å</h3>
      </div>
      
      <div id="cards-container"></div>
      <div id="overall-container"></div>
      <div class="recs" id="recs-container"></div>
    </div>
    
    <div class="actions">
      <button class="btn-save" onclick="saveAsImage()">üì∏ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç</button>
      <button class="btn-sec" onclick="location.reload()">–ü—Ä–æ–π—Ç–∏ –∑–∞–Ω–æ–≤–æ</button>
    </div>
    <div style="text-align:center; margin-top: 16px; font-size: 0.75rem; color: var(--c-gray);">
      –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Å–∞–º–æ—Ä–µ—Ñ–ª–µ–∫—Å–∏–∏. –ù–µ —è–≤–ª—è–µ—Ç—Å—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–º –¥–∏–∞–≥–Ω–æ–∑–æ–º.
    </div>
  </div>

</div>

<script>
// --- –î–ê–ù–ù–´–ï (–ö–ê–°–¢–û–ú–ù–´–ï –í–û–ü–†–û–°–´) ---
const questions = [
  {id:1, text:"–ö –∫–æ–Ω—Ü—É —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è —è —á—É–≤—Å—Ç–≤—É—é —Å–µ–±—è –∫–∞–∫ –≤—ã–∂–∞—Ç—ã–π –ª–∏–º–æ–Ω.", scale:"EX"},
  {id:2, text:"–ú–Ω–µ —Ö–æ—á–µ—Ç—Å—è –æ—Ç–≥–æ—Ä–æ–¥–∏—Ç—å—Å—è –æ—Ç –ø—Ä–æ–±–ª–µ–º –∫–æ–º–∞–Ω–¥—ã –∏ –ø–æ–±—ã—Ç—å –≤ –∞–±—Å–æ–ª—é—Ç–Ω–æ–π —Ç–∏—à–∏–Ω–µ.", scale:"CY"},
  {id:3, text:"–Ø –ª–µ–≥–∫–æ –Ω–∞—Ö–æ–∂—É —Ä–µ—à–µ–Ω–∏—è –¥–ª—è –Ω–µ—Ç–∏–ø–∏—á–Ω—ã—Ö —É–ø—Ä–∞–≤–ª–µ–Ω—á–µ—Å–∫–∏—Ö —Å–∏—Ç—É–∞—Ü–∏–π.", scale:"PE"},
  {id:4, text:"–ú—ã—Å–ª—å –æ —Å–ø–∏—Å–∫–µ —Ä–∞–±–æ—á–∏—Ö –∑–∞–¥–∞—á —Å —É—Ç—Ä–∞ –≤—ã–∑—ã–≤–∞–µ—Ç —É –º–µ–Ω—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é —Ç—è–∂–µ—Å—Ç—å.", scale:"EX"},
  {id:5, text:"–ú–µ–Ω—è –Ω–∞—á–∏–Ω–∞—é—Ç —Ä–∞–∑–¥—Ä–∞–∂–∞—Ç—å –ø—Ä–æ—Å—å–±—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∏–ª–∏ –∫–æ–ª–ª–µ–≥.", scale:"CY"},
  {id:6, text:"–Ø —á–µ—Ç–∫–æ –≤–∏–∂—É, —á—Ç–æ –º–æ–π –æ–ø—ã—Ç –ø—Ä–∏–Ω–æ—Å–∏—Ç —Ä–µ–∞–ª—å–Ω—É—é –ø–æ–ª—å–∑—É –±–∏–∑–Ω–µ—Å—É.", scale:"PE"},
  {id:7, text:"–ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –≤—Å—Ç—Ä–µ—á –∏–ª–∏ 1-on-1 —è –æ—â—É—â–∞—é —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é –ø—É—Å—Ç–æ—Ç—É.", scale:"EX"},
  {id:8, text:"–Ø –≤—ã–ø–æ–ª–Ω—è—é –º–Ω–æ–≥–∏–µ –∑–∞–¥–∞—á–∏ ¬´–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–µ¬ª, –ø–æ—Ç–µ—Ä—è–≤ –∫ –Ω–∏–º –∏—Å–∫—Ä–µ–Ω–Ω–∏–π –∏–Ω—Ç–µ—Ä–µ—Å.", scale:"CY"},
  {id:9, text:"–£ –º–µ–Ω—è –ø–æ–ª—É—á–∞–µ—Ç—Å—è –≤–¥–æ—Ö–Ω–æ–≤–ª—è—Ç—å –∫–æ–º–∞–Ω–¥—É –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π.", scale:"PE"},
  {id:10, text:"–ú–Ω–µ —Å—Ç–∞–ª–æ –Ω–µ —Ö–≤–∞—Ç–∞—Ç—å —Å–∏–ª –Ω–∞ –ª–∏—á–Ω—É—é –∂–∏–∑–Ω—å –∏ —Ö–æ–±–±–∏ –ø–æ—Å–ª–µ —Ä–∞–±–æ—Ç—ã.", scale:"EX"},
  {id:11, text:"–Ø –ª–æ–≤–ª—é —Å–µ–±—è –Ω–∞ –±–µ–∑—Ä–∞–∑–ª–∏—á–∏–∏ –∫ —Ç–æ–º—É, –±—É–¥—É—Ç –ª–∏ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç—ã —Ü–µ–ª–∏ –æ—Ç–¥–µ–ª–∞.", scale:"CY"},
  {id:12, text:"–Ø —á—É–≤—Å—Ç–≤—É—é –≥–æ—Ä–¥–æ—Å—Ç—å –∑–∞ –∫–∞—á–µ—Å—Ç–≤–æ —Ä–∞–±–æ—Ç—ã, –∫–æ—Ç–æ—Ä—É—é –¥–µ–ª–∞—é —è –∏ –º–æ—è –∫–æ–º–∞–Ω–¥–∞.", scale:"PE"},
  {id:13, text:"–Ø —Å—Ç–∞–ª(–∞) –±—ã—Å—Ç—Ä–µ–µ —É—Å—Ç–∞–≤–∞—Ç—å –æ—Ç —Ä—É—Ç–∏–Ω—ã, –∫–æ—Ç–æ—Ä–∞—è —Ä–∞–Ω—å—à–µ –¥–∞–≤–∞–ª–∞—Å—å –ª–µ–≥–∫–æ.", scale:"EX"},
  {id:14, text:"–Ø –≤—Å—ë —á–∞—â–µ —Å–æ–º–Ω–µ–≤–∞—é—Å—å –≤ —Ç–æ–º, —á—Ç–æ –º–æ—è —Ä–∞–±–æ—Ç–∞ –∏–º–µ–µ—Ç —Ä–µ–∞–ª—å–Ω—É—é —Ü–µ–Ω–Ω–æ—Å—Ç—å.", scale:"CY"},
  {id:15, text:"–Ø —É–≤–µ—Ä–µ–Ω(–∞) –≤ —Å–≤–æ–µ–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π –∫–æ–º–ø–µ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –∫–∞–∫ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è.", scale:"PE"}
];

let currentIndex = 0;
let answers = new Array(questions.length).fill(null);

// --- –õ–û–ì–ò–ö–ê –ò–ù–¢–ï–†–§–ï–ô–°–ê ---
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function startQuiz() {
  showScreen('screen-quiz');
  renderQuestion();
}

function renderQuestion() {
  const q = questions[currentIndex];
  document.getElementById('q-counter').innerText = `–í–æ–ø—Ä–æ—Å ${currentIndex + 1} –∏–∑ ${questions.length}`;
  document.getElementById('q-text').innerText = q.text;
  document.getElementById('prog').style.width = ((currentIndex) / questions.length * 100) + '%';
  
  // –ö–Ω–æ–ø–∫–∏ –ù–∞–∑–∞–¥/–î–∞–ª–µ–µ
  document.getElementById('btn-prev').style.visibility = currentIndex === 0 ? 'hidden' : 'visible';
  const btnNext = document.getElementById('btn-next');
  btnNext.innerText = currentIndex === questions.length - 1 ? '–†–µ–∑—É–ª—å—Ç–∞—Ç' : '–î–∞–ª–µ–µ';
  btnNext.disabled = answers[currentIndex] === null;

  // –†–µ–Ω–¥–µ—Ä –∫–Ω–æ–ø–æ–∫ 0-6
  const optsContainer = document.getElementById('opts-container');
  optsContainer.innerHTML = '';
  for(let i=0; i<=6; i++) {
    const btn = document.createElement('button');
    btn.className = 'opt-btn';
    if(answers[currentIndex] === i) btn.classList.add('selected');
    btn.innerText = i;
    btn.onclick = () => selectOption(i);
    optsContainer.appendChild(btn);
  }
}

function selectOption(val) {
  answers[currentIndex] = val;
  renderQuestion(); // –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏
}

function goNext() {
  if (currentIndex < questions.length - 1) {
    currentIndex++;
    renderQuestion();
  } else {
    calculateResults();
  }
}

function goPrev() {
  if (currentIndex > 0) {
    currentIndex--;
    renderQuestion();
  }
}

// --- –ü–û–î–°–ß–ï–¢ –ò –†–ï–ó–£–õ–¨–¢–ê–¢–´ ---
function calculateResults() {
  document.getElementById('prog').style.width = '100%';
  
  let scores = { EX: 0, CY: 0, PE: 0 };
  questions.forEach((q, i) => { scores[q.scale] += answers[i]; });

  // –ü–æ—Ä–æ–≥–∏ (–º–∞–∫—Å 30 –Ω–∞ —à–∫–∞–ª—É)
  const getLvEX = (s) => s<=10 ? 'good' : s<=19 ? 'warn' : 'bad';
  const getLvCY = (s) => s<=9  ? 'good' : s<=17 ? 'warn' : 'bad';
  const getLvPE = (s) => s>=22 ? 'good' : s>=15 ? 'warn' : 'bad'; // –∏–Ω–≤–µ—Ä—Å–∏—è

  const lvEX = getLvEX(scores.EX);
  const lvCY = getLvCY(scores.CY);
  const lvPE = getLvPE(scores.PE);

  const labels = {
    good: {EX:'–í –Ω–æ—Ä–º–µ', CY:'–í –Ω–æ—Ä–º–µ', PE:'–í—ã—Å–æ–∫–∞—è'},
    warn: {EX:'–ó–æ–Ω–∞ —Ä–∏—Å–∫–∞', CY:'–ó–æ–Ω–∞ —Ä–∏—Å–∫–∞', PE:'–°–Ω–∏–∂–µ–Ω–∞'},
    bad:  {EX:'–ö—Ä–∏—Ç–∏—á–Ω–æ', CY:'–ö—Ä–∏—Ç–∏—á–Ω–æ', PE:'–ö—Ä–∏—Ç–∏—á–Ω–æ –Ω–∏–∑–∫–∞—è'}
  };

  const cContainer = document.getElementById('cards-container');
  cContainer.innerHTML = '';
  
  cContainer.innerHTML += buildCard('–£—Ä–æ–≤–µ–Ω—å —ç–Ω–µ—Ä–≥–∏–∏ (–ò—Å—Ç–æ—â–µ–Ω–∏–µ)', scores.EX, lvEX, labels[lvEX].EX, 
    lvEX==='bad' ? '–°–∏–ª—å–Ω–æ–µ –∏—Å—Ç–æ—â–µ–Ω–∏–µ. –¢—Ä–µ–±—É–µ—Ç—Å—è —Å—Ä–æ—á–Ω—ã–π –æ—Ç–¥—ã—Ö –∏ –ø–µ—Ä–µ—Å–º–æ—Ç—Ä –∑–∞–¥–∞—á.' : 
    lvEX==='warn'? '–ù–∞–∫–æ–ø–ª–µ–Ω–Ω–∞—è —É—Å—Ç–∞–ª–æ—Å—Ç—å. –ü–æ—Ä–∞ –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å –≥—Ä–∞–Ω–∏—Ü—ã —Ä–∞–±–æ—á–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏.' : '–•–æ—Ä–æ—à–∏–π –±–∞–ª–∞–Ω—Å —ç–Ω–µ—Ä–≥–∏–∏ –∏ —É–º–µ–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è.');
  
  cContainer.innerHTML += buildCard('–í–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç—å (–û—Ç—Å—Ç—Ä–∞–Ω–µ–Ω–Ω–æ—Å—Ç—å)', scores.CY, lvCY, labels[lvCY].CY, 
    lvCY==='bad' ? '–ó–∞—â–∏—Ç–Ω—ã–π —Ü–∏–Ω–∏–∑–º. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–∞–∂—É—Ç—Å—è –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω—ã–º–∏.' : 
    lvCY==='warn'? '–ü–æ—è–≤–ª—è—é—Ç—Å—è –ø–µ—Ä–≤—ã–µ –∑–≤–æ–Ω–æ—á–∫–∏ –±–µ–∑—Ä–∞–∑–ª–∏—á–∏—è. –ò—â–∏—Ç–µ –Ω–æ–≤—ã–µ —Å–º—ã—Å–ª—ã.' : '–ñ–∏–≤–æ–π –∏–Ω—Ç–µ—Ä–µ—Å –∫ —Ä–∞–±–æ—Ç–µ –∏ —Ö–æ—Ä–æ—à–∏–π –∫–æ–Ω—Ç–∞–∫—Ç —Å –∫–æ–º–∞–Ω–¥–æ–π.');
  
  cContainer.innerHTML += buildCard('–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å', scores.PE, lvPE, labels[lvPE].PE, 
    lvPE==='bad' ? '–ö—Ä–∏–∑–∏—Å —Å–∞–º–æ–æ—Ü–µ–Ω–∫–∏ –∏ –æ–±–µ—Å—Ü–µ–Ω–∏–≤–∞–Ω–∏–µ —Å–≤–æ–∏—Ö —É—Å–ø–µ—Ö–æ–≤.' : 
    lvPE==='warn'? '–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ —Å–µ–±–µ –ø–æ—à–∞—Ç–Ω—É–ª–∞—Å—å, –≤—ã —Å—Ç–∞–ª–∏ —á–∞—â–µ —Å–æ–º–Ω–µ–≤–∞—Ç—å—Å—è.' : '–í—ã —á—É–≤—Å—Ç–≤—É–µ—Ç–µ —Å–µ–±—è –∫–æ–º–ø–µ—Ç–µ–Ω—Ç–Ω—ã–º –∏ –≤–∏–¥–∏—Ç–µ —Å–≤–æ–π –≤–∫–ª–∞–¥.');

  // Overall
  const badCount = [lvEX, lvCY, lvPE].filter(x=>x==='bad').length;
  const warnCount = [lvEX, lvCY, lvPE].filter(x=>x==='warn').length;
  let oTitle, oCol;
  
  if(badCount===0 && warnCount===0){ oTitle='–û—Ç–ª–∏—á–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ'; oCol='var(--s-good)'; }
  else if(badCount===0){ oTitle='–ù–∞—á–∞–ª—å–Ω–æ–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ'; oCol='var(--s-warn)'; }
  else if(badCount===1){ oTitle='–õ–æ–∫–∞–ª—å–Ω–æ–µ –≤—ã–≥–æ—Ä–∞–Ω–∏–µ'; oCol='var(--s-warn)'; }
  else { oTitle='–û—Å—Ç—Ä–æ–µ –≤—ã–≥–æ—Ä–∞–Ω–∏–µ'; oCol='var(--s-bad)'; }

  document.getElementById('overall-container').innerHTML = `
    <div class="overall-box">
      <h3 style="color:${oCol}">${oTitle}</h3>
      <p style="font-size:0.9rem">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –∫—É—Ä—Å–∞, —á—Ç–æ–±—ã —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ—é —É–ø—Ä–∞–≤–ª–µ–Ω—á–µ—Å–∫—É—é —Ä—É—Ç–∏–Ω—É.</p>
    </div>
  `;

  showScreen('screen-results');
  
  // –ê–Ω–∏–º–∞—Ü–∏—è –±–∞—Ä–æ–≤
  setTimeout(() => {
    document.getElementById('bar-ex').style.width = (scores.EX/30*100)+'%';
    document.getElementById('bar-cy').style.width = (scores.CY/30*100)+'%';
    document.getElementById('bar-pe').style.width = (scores.PE/30*100)+'%';
  }, 100);
}

function buildCard(title, score, level, label, desc) {
  return `
    <div class="r-card">
      <div class="score-line">
        <h4>${title}</h4>
        <span class="score-num col-${level}">${score}/30</span>
      </div>
      <div style="font-size:0.8rem; font-weight:600; margin-bottom:6px" class="col-${level}">${label}</div>
      <div class="bar-bg"><div class="bar-fg bg-${level}" id="bar-${title=== '–£—Ä–æ–≤–µ–Ω—å —ç–Ω–µ—Ä–≥–∏–∏ (–ò—Å—Ç–æ—â–µ–Ω–∏–µ)'?'ex':title.includes('–í–æ–≤–ª–µ—á')?'cy':'pe'}" style="width:0%"></div></div>
      <div class="r-desc">${desc}</div>
    </div>
  `;
}

// --- –≠–ö–°–ü–û–†–¢ –í –ö–ê–†–¢–ò–ù–ö–£ ---
function saveAsImage() {
  const target = document.getElementById('export-wrap');
  const btn = document.querySelector('.btn-save');
  const originalText = btn.innerText;
  
  btn.innerText = "‚è≥ –§–æ—Ä–º–∏—Ä—É–µ–º...";
  btn.disabled = true;

  // –ò—Å–ø–æ–ª—å–∑—É–µ–º html2canvas
  html2canvas(target, {
    scale: 2, // –≤—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ
    backgroundColor: '#ffffff'
  }).then(canvas => {
    const link = document.createElement('a');
    link.download = 'burnout-profile.png';
    link.href = canvas.toDataURL('image/png');
    link.click();
    
    btn.innerText = "‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!";
    setTimeout(() => { 
      btn.innerText = originalText; 
      btn.disabled = false;
    }, 2000);
  });
}
</script>
</body>
</html>
